<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registro de Empresa | Tienda Mas</title>
  <meta name="description" content="Registro de empresa - Tienda Mas. Completa los datos de la empresa y del representante legal." />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root{
      --primary:#FF6B35;
      --primary-dark:#E55627;
      --muted:#6B7280;
      --bg:#F8F9FA;
    }
    body{background:var(--bg);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    .input-focus:focus{outline: none; box-shadow: 0 0 0 3px rgba(255,107,53,0.15); border-color: var(--primary);}
    .req{color:#ef4444}
    /* small helpers */
    .field-error { color: #dc2626; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
  <main class="w-full max-w-6xl bg-white rounded-2xl shadow-xl p-10">
    <header class="mb-8 text-center">
      <h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center gap-2">
        <span class="text-orange-500">Tienda</span><span class="text-blue-600">Mas</span>
      </h1>
      <p class="text-gray-600 text-sm mt-2">Completa todos los campos para crear tu cuenta empresarial.</p>
    </header>

    <!-- Form -->
    <form id="companyForm" novalidate class="grid grid-cols-1 lg:grid-cols-2 gap-8" aria-describedby="formHelp">
      <p id="formHelp" class="lg:col-span-2 text-sm text-gray-500">Todos los campos marcados con <span class="req">*</span> son obligatorios.</p>

      <!-- Columna Izquierda -->
      <div class="space-y-6">
        <!-- Datos de Cuenta -->
        <section class="bg-gray-50 p-5 rounded-xl border">
          <h2 class="text-lg font-semibold text-gray-700 mb-4">Datos de Cuenta</h2>
          <div class="space-y-4">
            <div>
              <label for="username" class="block text-sm font-medium">Usuario <span class="req">*</span></label>
              <input id="username" name="username" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" placeholder="ej: miempresa2025"
                     aria-describedby="usernameError" aria-invalid="false" autocomplete="username" />
              <p id="usernameError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label for="email" class="block text-sm font-medium">Email <span class="req">*</span></label>
              <input id="email" name="email" type="email" class="w-full border rounded-lg px-4 py-2 input-focus" placeholder="empresa@correo.com"
                     aria-describedby="emailError" aria-invalid="false" autocomplete="email" />
              <p id="emailError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label for="password" class="block text-sm font-medium">Contraseña <span class="req">*</span></label>
              <div class="relative">
                <input id="password" name="password" type="password" class="w-full border rounded-lg px-4 py-2 pr-10 input-focus" placeholder="Mínimo 6 caracteres"
                       aria-describedby="passwordError" aria-invalid="false" autocomplete="new-password" />
                <button type="button" aria-label="Mostrar contraseña" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500" onclick="togglePassword('password', this)">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <p id="passwordError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label for="confirmPassword" class="block text-sm font-medium">Confirmar Contraseña <span class="req">*</span></label>
              <div class="relative">
                <input id="confirmPassword" name="confirmPassword" type="password" class="w-full border rounded-lg px-4 py-2 pr-10 input-focus" placeholder="Repite la contraseña"
                       aria-describedby="confirmPasswordError" aria-invalid="false" autocomplete="new-password" />
                <button type="button" aria-label="Mostrar confirmar contraseña" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500" onclick="togglePassword('confirmPassword', this)">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <p id="confirmPasswordError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>
          </div>
        </section>

        <!-- Representante -->
        <section class="bg-gray-50 p-5 rounded-xl border">
          <h2 class="text-lg font-semibold text-gray-700 mb-4">Representante Legal</h2>
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="repFirstName" class="block text-sm font-medium">Nombre <span class="req">*</span></label>
                <input id="repFirstName" name="repFirstName" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="repFirstNameError" aria-invalid="false" />
                <p id="repFirstNameError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
              <div>
                <label for="repLastName" class="block text-sm font-medium">Apellido <span class="req">*</span></label>
                <input id="repLastName" name="repLastName" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="repLastNameError" aria-invalid="false" />
                <p id="repLastNameError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="repGender" class="block text-sm font-medium">Género <span class="req">*</span></label>
                <select id="repGender" name="repGender" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="repGenderError" aria-invalid="false">
                  <option value="">Seleccionar</option>
                  <option value="femenino">Femenino</option>
                  <option value="masculino">Masculino</option>
                  <option value="no-binario">No binario</option>
                  <option value="prefiero-no-decirlo">Prefiero no decirlo</option>
                </select>
                <p id="repGenderError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>

              <div>
                <label for="repDocument" class="block text-sm font-medium">Documento (DNI/CUIL) <span class="req">*</span></label>
                <input id="repDocument" name="repDocument" type="text" inputmode="numeric" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="repDocumentError" aria-invalid="false" placeholder="Sólo números" />
                <p id="repDocumentError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Columna Derecha -->
      <div class="space-y-6">
        <!-- Empresa -->
        <section class="bg-gray-50 p-5 rounded-xl border">
          <h2 class="text-lg font-semibold text-gray-700 mb-4">Datos de la Empresa</h2>
          <div class="space-y-4">
            <div>
              <label for="businessName" class="block text-sm font-medium">Razón Social <span class="req">*</span></label>
              <input id="businessName" name="businessName" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="businessNameError" aria-invalid="false" />
              <p id="businessNameError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label for="cuit" class="block text-sm font-medium">CUIT <span class="req">*</span></label>
              <input id="cuit" name="cuit" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="cuitError" aria-invalid="false" placeholder="XX-XXXXXXXX-X o 11 dígitos" />
              <p id="cuitError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label for="ivaCondition" class="block text-sm font-medium">Condición ante IVA <span class="req">*</span></label>
              <select id="ivaCondition" name="ivaCondition" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="ivaConditionError" aria-invalid="false">
                <option value="">Seleccionar condición</option>
                <option>Responsable Inscripto</option>
                <option>Monotributo</option>
                <option>Exento</option>
                <option>Consumidor Final</option>
                <option>Otro</option>
              </select>
              <p id="ivaConditionError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>
          </div>
        </section>

        <!-- Dirección -->
        <section class="bg-gray-50 p-5 rounded-xl border">
          <h2 class="text-lg font-semibold text-gray-700 mb-4">Dirección</h2>
          <div class="space-y-4">
            <div class="grid grid-cols-3 gap-4">
              <div class="col-span-2">
                <label for="street" class="block text-sm font-medium">Calle <span class="req">*</span></label>
                <input id="street" name="street" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="streetError" aria-invalid="false" />
                <p id="streetError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
              <div>
                <label for="streetNumber" class="block text-sm font-medium">Número <span class="req">*</span></label>
                <input id="streetNumber" name="streetNumber" type="text" inputmode="numeric" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="streetNumberError" aria-invalid="false" />
                <p id="streetNumberError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4">
              <div>
                <label for="floor" class="block text-sm font-medium">Piso</label>
                <input id="floor" name="floor" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="floorError" aria-invalid="false" />
                <p id="floorError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
              <div>
                <label for="apartment" class="block text-sm font-medium">Departamento</label>
                <input id="apartment" name="apartment" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="apartmentError" aria-invalid="false" />
                <p id="apartmentError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
              <div>
                <label for="postalCode" class="block text-sm font-medium">Código Postal <span class="req">*</span></label>
                <input id="postalCode" name="postalCode" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="postalCodeError" aria-invalid="false" />
                <p id="postalCodeError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="city" class="block text-sm font-medium">Ciudad <span class="req">*</span></label>
                <input id="city" name="city" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="cityError" aria-invalid="false" />
                <p id="cityError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
              <div>
                <label for="province" class="block text-sm font-medium">Provincia <span class="req">*</span></label>
                <input id="province" name="province" type="text" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="provinceError" aria-invalid="false" />
                <p id="provinceError" class="text-sm field-error mt-1 hidden" role="alert"></p>
              </div>
            </div>

            <div>
              <label for="reference" class="block text-sm font-medium">Referencia</label>
              <textarea id="reference" name="reference" rows="2" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="referenceError" aria-invalid="false"></textarea>
              <p id="referenceError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>
          </div>
        </section>
      </div>

      <!-- Full width: Teléfono y Terms -->
      <div class="lg:col-span-2 space-y-6">
        <section class="bg-gray-50 p-5 rounded-xl border">
          <h2 class="text-lg font-semibold text-gray-700 mb-4">Teléfono de Contacto</h2>
          <div class="grid grid-cols-3 gap-4">
            <div>
              <label for="phoneArea" class="block text-sm font-medium">Característica (ej: 011) <span class="req">*</span></label>
              <input id="phoneArea" name="phoneArea" type="text" inputmode="numeric" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="phoneAreaError" aria-invalid="false" placeholder="011">
              <p id="phoneAreaError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>

            <div class="col-span-2">
              <label for="phoneNumber" class="block text-sm font-medium">Número <span class="req">*</span></label>
              <input id="phoneNumber" name="phoneNumber" type="text" inputmode="numeric" class="w-full border rounded-lg px-4 py-2 input-focus" aria-describedby="phoneNumberError" aria-invalid="false" placeholder="15XXXXYYYY">
              <p id="phoneNumberError" class="text-sm field-error mt-1 hidden" role="alert"></p>
            </div>
          </div>
        </section>

        <!-- Terms -->
        <div class="flex items-start gap-3">
          <input id="terms" name="terms" type="checkbox" class="mt-1 w-4 h-4" aria-describedby="termsError" />
          <label for="terms" class="text-sm text-gray-700">Acepto los <a href="#" class="text-orange-500 underline" target="_blank">Términos y Condiciones</a> y la <a href="#" class="text-orange-500 underline" target="_blank">Política de Privacidad</a> <span class="req">*</span></label>
        </div>
        <p id="termsError" class="text-sm field-error hidden" role="alert">Debes aceptar los términos y políticas.</p>

        <!-- Botón -->
        <div class="flex justify-end">
          <button id="submitBtn" type="submit" disabled class="bg-gradient-to-r from-orange-500 to-orange-400 disabled:opacity-60 text-white font-semibold px-8 py-3 rounded-lg shadow-lg inline-flex items-center transition">
            <span id="btnText">Crear cuenta</span>
            <svg id="spinner" class="ml-3 hidden animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>
          </button>
        </div>
      </div>
    </form>
  </main>

  <!-- JS: Validaciones (email, contraseña, teléfono) -->
  <script>
    // --- Helpers ---
    const qs = id => document.getElementById(id);
    const showError = (fieldId, message) => {
      const err = qs(fieldId + 'Error');
      if (!err) return;
      err.textContent = message;
      err.classList.remove('hidden');
      const field = qs(fieldId);
      if (field) field.setAttribute('aria-invalid', 'true');
    };
    const hideError = (fieldId) => {
      const err = qs(fieldId + 'Error');
      if (!err) return;
      err.textContent = '';
      err.classList.add('hidden');
      const field = qs(fieldId);
      if (field) field.setAttribute('aria-invalid', 'false');
    };

    // Regex / reglas
    const usernameRe = /^[A-Za-z0-9._-]{6,16}$/;
    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // razonable para cliente
    const passwordRe = /^[A-Za-z0-9!@#$%^&*()_+\-=\{\}\[\]:;,.?\/]{6,16}$/;
    const phoneAreaRe = /^\d{2,4}$/; // e.g. 11, 381, 0299
    const phoneNumberRe = /^\d{6,15}$/; // teléfono principal
    const digitsOnly = /^\d+$/;

    // Toggle password visibility
    function togglePassword(fieldId, btn) {
      const field = qs(fieldId);
      if (!field) return;
      const icon = btn.querySelector('i');
      if (field.type === 'password') {
        field.type = 'text';
        if (icon) { icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash'); }
      } else {
        field.type = 'password';
        if (icon) { icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye'); }
      }
      field.focus();
    }

    // Validadores individuales
    function validateUsername() {
      const v = (qs('username').value || '').trim();
      if (!v) { showError('username', 'Usuario requerido'); return false; }
      if (!usernameRe.test(v)) { showError('username', '6-16 caracteres. Letras, números, . _ - permitidos.'); return false; }
      hideError('username'); return true;
    }

    function validateEmail() {
      const v = (qs('email').value || '').trim();
      if (!v) { showError('email', 'Email requerido'); return false; }
      if (!emailRe.test(v)) { showError('email', 'Formato de email inválido'); return false; }
      hideError('email'); return true;
    }

    function validatePassword() {
      const v = (qs('password').value || '');
      if (!v) { showError('password','Contraseña requerida'); return false; }
      if (!passwordRe.test(v)) { showError('password','6-16 caracteres. Solo los símbolos permitidos.'); return false; }
      hideError('password'); return true;
    }

    function validateConfirmPassword() {
      const p = (qs('password').value || '');
      const v = (qs('confirmPassword').value || '');
      if (!v) { showError('confirmPassword','Confirmar contraseña requerida'); return false; }
      if (p !== v) { showError('confirmPassword','Las contraseñas no coinciden'); return false; }
      hideError('confirmPassword'); return true;
    }

    function validatePhoneArea() {
      const v = (qs('phoneArea').value || '').trim();
      if (!v) { showError('phoneArea','Característica requerida'); return false; }
      if (!phoneAreaRe.test(v)) { showError('phoneArea','Formato inválido (ej: 011, 381)'); return false; }
      hideError('phoneArea'); return true;
    }

    function validatePhoneNumber() {
      const v = (qs('phoneNumber').value || '').trim();
      if (!v) { showError('phoneNumber','Número requerido'); return false; }
      if (!phoneNumberRe.test(v)) { showError('phoneNumber','Número inválido. 6-15 dígitos.'); return false; }
      hideError('phoneNumber'); return true;
    }

    // Estado del botón (habilitar solo cuando los checks básicos son válidos)
    function updateSubmitState() {
      const allValid = validateUsername() && validateEmail() && validatePassword() && validateConfirmPassword()
                       && validatePhoneArea() && validatePhoneNumber() && qs('terms').checked;
      qs('submitBtn').disabled = !allValid;
      if (!qs('terms').checked) {
        showError('terms','Debes aceptar los términos y políticas.');
      } else {
        hideError('terms');
      }
      return allValid;
    }

    // Eventos en tiempo real (debounce ligero para email)
    const debounce = (fn, wait=300) => {
      let t;
      return (...args) => { clearTimeout(t); t = setTimeout(()=>fn(...args), wait); };
    };

    qs('username')?.addEventListener('input', () => { validateUsername(); updateSubmitState(); });
    qs('email')?.addEventListener('input', debounce(()=>{ validateEmail(); updateSubmitState(); }, 250));
    qs('password')?.addEventListener('input', () => { validatePassword(); validateConfirmPassword(); updateSubmitState(); });
    qs('confirmPassword')?.addEventListener('input', () => { validateConfirmPassword(); updateSubmitState(); });
    qs('phoneArea')?.addEventListener('input', () => { validatePhoneArea(); updateSubmitState(); });
    qs('phoneNumber')?.addEventListener('input', () => { validatePhoneNumber(); updateSubmitState(); });
    qs('terms')?.addEventListener('change', updateSubmitState);

    // Submit
    qs('companyForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      // Revalidar todo
      const ok = updateSubmitState();
      if (!ok) {
        // focus al primer campo inválido
        const firstErr = document.querySelector('.field-error:not(.hidden)');
        if (firstErr) {
          const relatedId = firstErr.id.replace('Error','');
          const fld = qs(relatedId);
          if (fld) fld.focus();
        }
        return;
      }

      // Simular envío
      qs('submitBtn').disabled = true;
      qs('btnText').textContent = 'Creando cuenta...';
      qs('spinner').classList.remove('hidden');

      try {
        // Simula llamada al servidor (reemplazar por fetch real)
        await new Promise(r => setTimeout(r, 900));

        // Éxito demo
        alert('Cuenta de empresa creada correctamente. (Demo)');
        qs('companyForm').reset();
        // limpiar errores
        document.querySelectorAll('[id$="Error"]').forEach(el => { el.textContent=''; el.classList.add('hidden'); });
      } catch (err) {
        alert('Ocurrió un error al crear la cuenta. Intenta nuevamente.');
      } finally {
        qs('btnText').textContent = 'Crear cuenta';
        qs('spinner').classList.add('hidden');
        qs('submitBtn').disabled = true; // dejar deshabilitado hasta que vuelva a validar
      }
    });

    // Inicializar (por si vuelve a cargar)
    document.addEventListener('DOMContentLoaded', () => {
      // ocultar errores por defecto
      document.querySelectorAll('[id$="Error"]').forEach(el => el.classList.add('hidden'));
      qs('submitBtn').disabled = true;
    });
  </script>
</body>
</html>
